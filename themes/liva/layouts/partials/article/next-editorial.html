{{/*
    Prints the next 2 articles in the same section or, if less or 2 found, the first (and potentially second) of the section.

    @author @regisphilibert @mountainbug95

    @context Type Page (.)

    @access public

*/}}

{{/* declaring next empty slice */}}
{{ $next := slice }}
{{/* Checking if current article has a PrevInSection (Prev as we are ordering dsc here.) */}}
{{ with .PrevInSection }}
    {{ $next = $next | append . }}
    {{/* Checking for that "next" article own "next" to fill the "second next" */}}
    {{ with .PrevInSection }}
        {{ $next = $next | append . }}
    {{ end }}
{{ end }}
{{/* If the number of found "next article" is less than two we need to find the first and potentially second article
of the whole section and append them to our $next slice. */}}
{{ $diff := sub 2 (len $next) }}
{{ if $diff }}
    {{/* We use that diff number (if > 0) to grab the first x number of articles */}}
    {{ $articles := partialCached "func/GetEditorials" . "articles"}}
    {{ $next = $next | append (first $diff $articles) }}
{{ end }}
<section id="articleNext" class="section nartrow">
    <h3 class="footer-next-heading">More articles from {{ .Site.Title }}</h3>
        <div class="row">
            {{ range $index, $article := $next }}
                <a href="{{ $article.RelPermalink }}" class=""
                {{ if not $index}} id="article-link-bigger"{{ end }}>
                    <div class="col-lg-6">
                          {{ if .Params.Image }}
                          <div class="img-fluid next-post-thumb mr-3" style="background-image: url('{{ .Params.Image | absURL }}');"></div>
                          {{ end }}
                          <div class="media-body">
                            <div class="mb-3 post-meta">
                              {{ $authors := partialCached "func/GetArticleAuthors" . .File.UniqueID }}
                              {{ if eq (len $authors) 1 }}
                                  {{ with $author := index $authors 0 }}
                                              {{ with .name }}
                                              <span>By {{ . }}</span>
                                              {{ end }}
                                  {{ end }}
                              {{ else }}
                                  <span>By 
                                              {{ range $index, $author := $authors }}
                                                  {{ .firstname }}{{ if ne (add $index 1) (len $authors) }},{{ end }}
                                              {{ end }}</span>
                              {{ end }}
                              {{ if not .Params.HideDate }}
                              <span> Â· </span>
                              <span>{{ .PublishDate.Format "02 Jan 2006" }}</span>
                              {{ end }}
                            </div>
                            <a href="{{ .Permalink }}" class="h5 d-block mb-3">{{ .Title | markdownify }}</a>
                          </div>
                    </div>
                </a>
            {{ end }}
        </div>
    </div>
</section>
